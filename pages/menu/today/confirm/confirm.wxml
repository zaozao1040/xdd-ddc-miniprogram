<view class="wrapper">
    <!-- 弹出层 分时段取餐 -->
    <c-takeMeal wx:if="{{takeMealLimitFlag}}" takeMealLimitFlag='{{takeMealLimitFlag}}'
        takeMealLimitLists='{{takeMealLimitLists}}' takeMealLimitMealTypes='{{takeMealLimitMealTypes}}'
        bind:handleTakeMealLimitConfirm='handleTakeMealLimitConfirm'></c-takeMeal>

    <!-- 弹出层 填写取餐人 送餐地址 -->
    <view class="modulebox-background-wrapper" wx:if="{{showSelectFlag}}">
        <view class="modulebox-wrapper">
            <view class="section-3" style='margin-top:40rpx;padding:0 20rpx;'>
                <view class="section-3-1 ">
                    <image src="/images/mine/organize_name.png" style='width:48rpx;height:48rpx;'></image>
                </view>

                <input bindinput="nameInput" value="{{userName}}" class="section-3-2" placeholder="请输入真实姓名"
                    type="string"></input>
            </view>
            <view class="section-3" style="margin-top: 20rpx;padding:0 20rpx;" catchtap="showAddress">
                <view class="section-3-1">
                    <image src="/images/mine/organize.png" style='width:48rpx;height:48rpx;'></image>
                </view>
                <input bindinput="addressInput" value="{{address}}" placeholder="搜索企业简称，例如：星点点"
                    data-organizecode="{{organizeCode}}" class="section-3-2" type="string"
                    bindtap="handleSelectAddress"></input>
            </view>

            <view class='button-display'>
                <view class='button-left' bindtap='handleChangeSelectFlag'>取消</view>
                <view class='button-right' bindtap='handleCheckParams'>确定</view>
            </view>
        </view>
    </view>
    <!-- 弹出层 填写钱包支付提示 -->
    <c-custom-modal content='使用钱包支付' title='支付提示' money='￥{{realMoney}}' wx:if='{{balanceConfirmFlag}}'
        bind:closemodal='closeBalanceConfirmFlag' bind:handleconfirm='handleCommitPay'></c-custom-modal>

    <!-- 默认地址 -->
    <view class="address-wrapper c_buttonPosition_forCalculate_top" bindtap="handleChangeSelectFlag">
        <view class="address-wrapper-top">
            <view class="address-line2" wx:if="{{address}}">
                {{address}}
            </view>
            <view class="address-line2" wx:else>
                请选择送餐地址
            </view>
            <view class="address-line1">
                <view style='margin-right:30rpx;'>
                    <block wx:if="{{userName}}">
                        {{userName}}
                    </block>
                    <block wx:else>
                        <text>请填写真实姓名</text>
                    </block>
                </view>
                <view>
                    {{phoneNumber}}
                </view>
            </view>
        </view>
        <view class="address-wrapper-bottom">
            <text class='iconfont icon-icon_on_the_right' style="font-size:40rpx;color:#fff;"></text>
        </view>
    </view>
    <!-- 分时段取餐设置 -->
    <view wx:if="{{takeMealLimitFlag}}" class="takeMealLimit-wrapper" bindtap="showTakeMealLimit">
        <view class="takeMealLimit-font" wx:if="{{takeMealLimitTitleDes==''}}">
            取餐时段设置
        </view>
        <view class="takeMealLimit-font" wx:else>
            {{takeMealLimitTitleDes}}
        </view>
        <view class="takeMealLimit-icon">
            <image class="takeMealLimit-image" src='/images/menu/edit.png'></image>
        </view>

    </view>
    <!-- 已选菜单 -->
    <scroll-view scroll-y style="height:{{buttonTop-addressBottom}}px;">
        <view style="background: #F5F5F5;border-radius: 6rpx;">

            <view class="cart-day-wrapper">
                <view wx:for="{{selectedFoods}}" wx:for-item='oneday' wx:for-index='onedayindex' wx:key="onedayindex">

                    <view wx:if="{{oneday.count>0}}">
                        <view wx:for="{{mealEnglistLabel}}" wx:key="index">
                            <view wx:if='{{oneday[item]&&oneday[item].selectedFoods.length>0}}'>
                                <view class="cart-day-title">{{oneday.appointment}}({{oneday.mealDateShow}})
                                    {{oneday[item].name}}</view>

                                <view class="cart-menuItem" wx:for="{{oneday[item].selectedFoods}}"
                                    wx:for-item="foodtypeinfoItem" wx:for-index="foodtypeinfoIndex"
                                    wx:key="foodtypeinfoIndex">
                                    <view class="cart-menuItem-left">
                                        <image class="cart-menuItem-img" src="{{foodtypeinfoItem.image}}"></image>
                                    </view>
                                    <view class='flex-1'>
                                        <view class='cart-menuItem-name'>
                                            <view class="cart-menuItemDes">{{foodtypeinfoItem.foodName}}</view>
                                            <view class='flex-a'>
                                                <view class="cart-menuItem-originmoney"
                                                    wx:if="{{foodtypeinfoItem.foodTotalOriginalPrice>foodtypeinfoItem.foodTotalPrice}}">
                                                    ¥{{foodtypeinfoItem.foodTotalOriginalPrice}}</view>
                                                <view class="cart-menuItem-money">¥{{foodtypeinfoItem.foodTotalPrice}}
                                                </view>
                                            </view>
                                        </view>
                                        <view class="cart-menuItem-mealtype">
                                            <text
                                                style="margin-right:10rpx;">{{oneday[item].name}}</text><text>x{{foodtypeinfoItem.foodCount}}</text>
                                        </view>
                                    </view>
                                </view>

                                <view class='cart-organize-deduction'>
                                    <view class='cart-discount-organize'>企业抵扣</view>
                                    <view class='cart-discount-organize-money'>-￥{{oneday[item].deductionMoney}}</view>
                                </view>
                                <view class='pay-item-last' data-mealdate="{{oneday.mealDate}}"
                                    data-mealtypename="{{oneday[item].name}}"
                                    data-discountnum="{{oneday[item].discountNum}}" bindtap="handleGotoDiscount">
                                    <view class='pay-title' style='padding:30rpx 0;'>优惠券</view>
                                    <view class='flex-a'>
                                        <view style='padding:30rpx 0;'>
                                            <block wx:if="{{oneday[item].discountSelectedFlag}}">
                                                <view class="pay-discount-money">
                                                    -￥{{oneday[item].discountSelectedInfo.discountMoney}}
                                                </view>
                                            </block>
                                            <block wx:else>
                                                <view wx:if="{{oneday[item].discountNum&&oneday[item].discountNum!==0}}"
                                                    class="pay-discount-money">
                                                    {{oneday[item].discountNum}}张可用
                                                </view>
                                                <view wx:else class='pay-no-discount'>暂无可用</view>
                                            </block>
                                        </view>
                                        <view>
                                            <image src='/images/menu/right.png'
                                                style="height:22rpx;width:12rpx; margin:42rpx 0 0 20rpx;"></image>
                                        </view>
                                    </view>

                                </view>
                            </view>
                        </view>
                    </view>
                </view>
            </view>

            <view style='margin:0 16rpx;'>
                <view style='background:#fff;padding:0 30rpx;border-radius:6rpx;'>
                    <view class='pay-item-last' style='border-bottom: 1rpx solid #F2F2F2;'>
                        <view class='pay-title' style='line-height:98rpx;'>支付方式</view>
                    </view>
                    <view class='pay-item-last' style='padding-bottom:26rpx;border-bottom: 1rpx solid #F2F2F2;'>
                        <view wx:if='{{!canUseBalance}}'
                            style='background:rgba(255,255,255,0.5);position:absolute;width:660rpx;height:100rpx;z-index:90;'>
                        </view>
                        <view class='flex-a' style="margin-top:32rpx;">
                            <view style='padding-top:2rpx;margin-right:10rpx;width:40rpx;height:40rpx;'>
                                <image src="/images/menu/wallet.png" style="width:40rpx;height:40rpx;">
                                </image>
                            </view>
                            <!--allowUserOrganizePayNoCanMeal为true，就是个人钱包，否则就是钱包余额-->
                            <block>
                                <view class='pay-balance'>钱包支付({{balanceDes}})</view>
                                <image src='/images/menu/diancanbi.png'
                                    style='width:28rpx;height:28rpx;padding:6rpx 8rpx 0;'></image>
                                <view class='pay-balance'>{{canUseBalance}})</view>
                            </block>
                            <!-- <block wx:else>
                                <view class='pay-balance'>钱包支付(钱包余额</view>
                                <image src='/images/menu/diancanbi.png' style='width:28rpx;height:28rpx;padding:6rpx 8rpx 0;'></image>
                                <view class='pay-balance'>{{allBalance}})</view>
                            </block> -->
                        </view>
                        <!--余额钱包亮时，点余额钱包变为微信支付-->
                        <!--余额钱包不亮时，点余额钱包判断可为余额支付还是余额+微信支付-->
                        <!--微信支付不亮时，点微信支付变为微信支付-->
                        <view style='margin-top:28rpx;width:44rpx;height:44rpx;'>
                            <image src="/images/menu/check.png" style="width:44rpx;height:44rpx;"
                                bindtap="handleChangeWechatPayFlag"
                                wx:if="{{payType=='BALANCE_PAY' ||payType=='BALANCE_MIX_WECHAT_PAY'}}">
                            </image>
                            <image src="/images/menu/uncheck.png" style="width:44rpx;height:44rpx;" wx:else
                                bindtap="handleChangeBalancePayFlag">
                            </image>
                        </view>
                    </view>
                    <view class='pay-item-last' style='padding-bottom:26rpx;'>
                        <view class='flex-a'>
                            <image src="/images/menu/order_wechatpay.png"
                                style="padding-top:34rpx;width:40rpx;height:40rpx;">
                            </image>
                            <view class='pay-wechat'>微信支付</view>
                        </view>
                        <view style='margin-top:28rpx;width:44rpx;height:44rpx;'>
                            <image src="/images/menu/check.png" style="width:44rpx;height:44rpx;"
                                wx:if="{{payType=='WECHAT_PAY'||payType=='BALANCE_MIX_WECHAT_PAY'}}">
                            </image>
                            <image src="/images/menu/uncheck.png" catchtap="handleChangeWechatPayFlag"
                                style="width:44rpx;height:44rpx;" wx:else></image>

                        </view>
                    </view>
                </view>
            </view>
            <view style='margin:16rpx 16rpx 0;' wx:if='{{orgAdmin}}'>

                <view class='remark-manage'>
                    <view class='pay-title' style='padding:30rpx 0;'>订单备注</view>
                    <view class='flex-a' bindtap='gotoRemark'>
                        <view class='pay-no-discount' style='padding:30rpx 0;'>去备注</view>
                        <image src='/images/menu/right.png' style="height:22rpx;width:12rpx; margin:42rpx 0 0 20rpx;">
                        </image>
                    </view>

                </view>
            </view>
        </view>
    </scroll-view>

    <view class="pay-bottom-wrapper c_buttonPosition_forCalculate">
        <view class='pay-bottom-money'>
            <view
                style='width:158rpx;text-align:center;font-family: PingFang-SC-Medium; font-size: 40rpx; color: #FFFFFF;letter-spacing: 0;border-right:1rpx solid rgba(255,255,255,0.40);line-height:40rpx;'>
                ￥{{realMoney}}
            </view>
            <view
                style='padding-left:10rpx;font-family: PingFang-SC-Regular; font-size: 14px;color: rgba(255,255,255,0.40); letter-spacing: 0; text-align: left;'>
                已优惠￥{{totalDeduction}}
            </view>
        </view>
        <view class='pay-button' bindtap="handleCommitPayCheck">确认支付</view>
    </view>
</view>