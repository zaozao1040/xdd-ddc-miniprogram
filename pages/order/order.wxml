<!--pages/order/order.wxml-->
<view>
    <!-- 去付款弹出的选择支付方式对话框 -->
    <view class="selectPayType-wrapper" wx:if="{{showPayTypeFlag}}">
        <view class="selectPayType">
            <view class="selectPayType_line1" style="margin:20rpx 10rpx 30rpx 20rpx;font-size: 40rpx;color:#666;">
                请选择支付方式
            </view>
            <radio-group class="radio-group" style="margin:10rpx 40rpx;" bindchange="radioChange">
                <label class="radio" style="display: block;margin-bottom: 40rpx;">
          <radio value="WECHAT_PAY" checked="{{payType=='WECHAT_PAY'}}" />
          <text style="font-size: 35rpx;" decode>&nbsp;微信支付</text>
        </label>
                <label class="radio" style="display: block;margin-bottom: 40rpx;">
          <radio value="BALANCE_PAY" checked="{{payType=='BALANCE_PAY'}}" />
          <text style="font-size: 35rpx;" decode>&nbsp;余额支付</text>
        </label>
            </radio-group>
            <view style="display:flex;justify-content: space-between;margin:30rpx 20rpx;">
                <button size="mini" class="selectPayType_line3" bindtap="buttonClickNo">
          取消
        </button>
                <button size="mini" class="selectPayType_line3" bindtap="buttonClickYes" style="background:#e79b37;color:#fff;">
          确定
        </button>
            </view>
        </view>
    </view>
    <!-- 去评价弹出的对话框 -->
    <form report-submit="true" bindsubmit="buttonClickYes_ratings">
        <view class="ratings-wrapper" wx:if="{{showRatingsFlag}}">
            <view class="ratings-wrapper-content">
                <view class="foodList-wrapper" wx:for="{{foods}}" wx:for-index="foodIndex" wx:for-item="foodItem" wx:key="foodIndex">
                    <!-- 单个菜品的评价 -->
                    <view class="fooditem-wrapper">
                        <view class="foodname">
                            {{foodItem.name}}
                        </view>
                        <view class="foodstar">
                            <block wx:for="{{starNum}}" wx:for-index="starIndex" wx:for-item="starItem" wx:key="starIndex">
                                <text class="iconfont icon-xingxing {{starIndex+1<=starActiveNum?'foodstar-active':''}}" decode bindtap="handleClickStar" data-num="{{starIndex+1}}">&nbsp;</text>
                            </block>
                        </view>
                        <view class="foodratingcontent-wrapper">
                            <textarea class="foodratingcontent" bindinput="ratingsInput" placeholder="我要提出建议..." maxlength="60" focus />
                        </view>
                        <view class="img-wrapper">
                            <image class="image" src="{{imgItem}}" wx:for="{{tempFilePaths}}" wx:for-index="imgIndex" wx:for-item="imgItem" wx:key="imgIndex" bindtap="handlePreviewImage" data-index="{{imgIndex}}"></image>
                            <image class="image" wx:if="{{tempFilePaths.length<3}}" src="/images/order/shangchuantupian.png" bindtap="handleClickAddImg"></image>
                        </view>
                    </view>
                </view>
                <view style="display:flex;justify-content: space-between;margin:30rpx 20rpx;">
                    <button style="width:200rpx;" bindtap="buttonClickNo_ratings">
            取消
          </button>
                    <button style="width:200rpx;background:#e79b37;color:#fff;" formType="submit">
            确定
          </button>
                </view>
            </view>
        </view>
    </form>
    <view class="mask" wx:if="{{cancelFlag}}" catchtouchmove="preventTouchMove"></view>
    <!--取消订单弹出框-->
    <view style='border-radius: 16rpx;position:fixed;width:560rpx;height:310rpx;bottom:0;top:0;left:0;right:0;margin:auto;background:#fff;z-index:10002;' wx:if='{{cancelFlag}}'>
        <view style='font-family: PingFang-SC-Medium;font-size: 18px;color: #000000;text-align: center;margin:60rpx 0;text-align: center;'>
            确定要取消订单吗？
        </view>
        <view style='display:flex;justify-content: space-between;margin:0 30rpx;'>
            <view class='cancel-wait' catchtap='handleCancelOrderWait'>再等等</view>
            <view class='cancel-confirm' catchtap='handleCancelOrderConfirm'>确定取消</view>
        </view>
    </view>
    <!-- 标题 -->
    <view class="header-wrapper">
        <view catchtap="changeItemStatusActiveFlag" data-flag="jinridaiqu">
            <view class=" {{itemStatusActiveFlag==true?'header-item-active':'header-item'}}">今日待取</view>
            <view class="{{itemStatusActiveFlag==true?'header-item-border-active':'header-item-border'}}"></view>
        </view>
        <view catchtap="changeItemStatusActiveFlag" data-flag="jinridaiqu">
            <view class="{{itemStatusActiveFlag==false?'header-item-active':'header-item'}}">待评价</view>
            <view class="{{itemStatusActiveFlag==false?'header-item-border-active':'header-item-border'}}"></view>
        </view>
        <view catchtap="changeItemStatusActiveFlag" data-flag="quanbudingdan">
            <view class=" {{itemStatusActiveFlag==false?'header-item-active':'header-item'}}">全部订单</view>
            <view class="{{itemStatusActiveFlag==false?'header-item-border-active':'header-item-border'}}"></view>

        </view>
    </view>
    <scroll-view class="order-wrapper c_scrollPosition_forCalculate" scroll-y style="height: {{windowHeight - scrollTop}}px;">
        <view wx:if="{{orderListNoResult}}" class="noResult" style="font-size:30rpx;color:#666;text-align: center;height: 80rpx;line-height: 80rpx;">
            未查询到充值记录..
        </view>
        <view wx:else>
            <view wx:for="{{orderList}}" wx:for-index="orderIndex" wx:for-item="orderItem" wx:key="orderIndex">
                <view style='box-shadow: 0 0 10px 0 rgba(0,0,0,0.08); border-radius: 6px;background: #FFFFFF;margin:24rpx 20rpx 0;padding:30rpx 30rpx 40rpx 30rpx;display:flex;'>
                    <view style="height:88rpx;width:88rpx;border:1rpx solid red;flex-shrink: 0;"></view>
                    <view style="margin-left:20rpx;flex-grow:1;">
                        <view style="display:flex;justify-content: space-between;border-bottom:1rpx solid #eee;height:108rpx;">
                            <view>
                                <view class='food-name'>
                                    <!--名称可能会溢出，需要指定最长的width-->
                                    <view>{{orderItem.foods[0].name}}</view>
                                    <view style="margin-left:14rpx;" wx:if='{{orderItem.foods.length>1}}'>等{{orderItem.foods.length}}件</view>
                                </view>
                                <view class='food-mealtype'>{{orderItem.mealTypeDes}}</view>
                            </view>
                            <view wx:if="{{orderItem.cabinet}}">
                                <view class='order-cabinet-title'>柜子号</view>
                                <view class='order-cabinet-num'>{{orderItem.cabinet}}</view>
                            </view>
                            <view wx:elif="{{orderItem.foods[0].boxNumber}}">
                                <view class='order-cabinet-title'>箱子</view>
                                <view class='order-cabinet-num'>{{orderItem.foods[0].boxNumber}}</view>
                            </view>
                            <!--因为 订单自动取消 会换行，这些订单状态需要和志康讨论-->
                            <view wx:else class='order-status'>
                                {{orderItem.orderStatusDes}}
                            </view>
                        </view>
                        <view style="display:flex;justify-content: space-between;padding:21rpx 0 40rpx;">
                            <view class='food-takeorder' wx:if="{{itemStatusActiveFlag}}">取餐时间：今天{{orderItem.takeMealStartTimeDes}}到{{orderItem.takeMealEndTimeDes}}</view>
                            <view class='food-takeorder' wx:else>取餐时间：{{orderItem.takeMealDate}}</view>
                            <view class='food-money'>￥{{orderItem.payPrice}}</view>
                        </view>
                        <view style="display:flex;justify-content: flex-end;">
                            <view class='see-detail' bindtap="handleGotoOrderDetail" data-ordercode="{{orderItem.orderCode}}">查看详情</view>
                            <block wx:if="{{!orderItem.expiredFlag}}">
                                <view class='see-detail' style='margin-left:16rpx;' catchtap="handleCancelOrder" data-orderindex="{{orderIndex}}" data-ordercode="{{orderItem.orderCode}}" data-payprice="{{orderItem.payPrice}}" data-paystatus="{{orderItem.payStatus}}" wx:if="{{orderItem.orderStatus  == 'PAYED_WAITINT_CONFIRM' || orderItem.orderStatus  == 'NO_PAY'}}">
                                    取消订单
                                </view>
                                <view class='take-food' catchtap="handleEvaluateOrder" data-orderindex="{{orderIndex}}" data-ordercode="{{orderItem.orderCode}}" data-foodcode="{{orderItem.foods[0].foodCode}}" data-foods="{{orderItem.foods}}" wx:if="{{orderItem.evaluateFlag}}">
                                    评价
                                </view>
                                <view class='take-food' catchtap="handleTakeOrder" data-ordercode="{{orderItem.orderCode}}" data-cabinet="{{orderItem.cabinet}}" wx:if="{{orderItem.takeMealFlag}}">
                                    取餐
                                </view>
                                <view class='take-food' catchtap="handleSecondpayOrder" data-orderindex="{{orderIndex}}" data-ordercode="{{orderItem.orderCode}}" wx:if="{{orderItem.orderStatus  == 'NO_PAY' }}">
                                    付款
                                </view>
                            </block>
                        </view>
                    </view>

                </view>
            </view>
            <view class="hasMore-wrapper" wx:if="{{hasMoreDataFlag}}" bindtap="gotoNextPage" style="margin-top:60rpx;font-family: PingFang-SC-Regular; font-size: 26rpx; color: #666666; letter-spacing: 0; text-align: center;">
                点击加载更多
            </view>
            <view wx:else class="hasMore-wrapper" style="margin-top:60rpx;font-family: PingFang-SC-Regular; font-size: 26rpx; color: #666666; letter-spacing: 0; text-align: center;">
                没有更多了..
            </view>
        </view>

    </scroll-view>
</view>
<!-- 内容 -->
<!-- <scroll-view class="order-wrapper c_scrollPosition_forCalculate" scroll-y style="height: {{windowHeight - scrollTop}}px;">
        <view wx:if="{{orderListNoResult}}" class="noResult" style="font-size:30rpx;color:#666;text-align: center;height: 80rpx;line-height: 80rpx;">
            未查询到充值记录..
        </view>
        <view wx:else>
            <view bindtap="handleGotoOrderDetail" data-ordercode="{{orderItem.orderCode}}" class="order-item" wx:for="{{orderList}}" wx:for-index="orderIndex" wx:for-item="orderItem" wx:key="orderIndex">
                <view class="order-item-header {{orderItem.expiredFlag?'order-item-header-old':''}}">
                    <view style="display:flex;justify-content: space-between;">
                        <view class="order-type">
                            {{orderItem.mealTypeDes}}
                        </view>
                        <view class="order-cabinet {{orderItem.expiredFlag?'order-cabinet-old':''}}" wx:if="{{orderItem.cabinet}}">
                            柜号:{{orderItem.cabinet}}
                        </view>

                        <view class="order-status">
                            {{orderItem.orderStatusDes}}
                        </view>
                    </view>
                    <view class="order-time">
                        <text class='iconfont icon-shijian' decode>&nbsp;</text>{{orderItem.mealDateDes}}用餐
                        <view class="{{orderItem.expiredFlag?'':'order-time-warnning'}}" style="text-align:center;font-size:30rpx;">
                            <text class="iconfont icon-tixing1"></text>取餐时间:{{orderItem.takeMealStartTimeDes}}~{{orderItem.takeMealEndTimeDes}}
                        </view>
                    </view>
                </view>
                <view class="order-item-content {{orderItem.expiredFlag?'order-item-content-old':''}}">
                    <view class="foods-wrapper">
                        <view class="food-item" wx:for="{{orderItem.foods}}" wx:for-index="foodIndex" wx:for-item="foodItem" wx:key="foodIndex">
                            <view style="display:flex;justify-content: space-between;">
                                <view class="food-name">
                                    {{foodItem.name}}
                                </view>
                                <view class="food-count">
                                    x{{foodItem.quantity}}
                                </view>
                                <view wx:if="{{foodItem.boxNumber}}" class="food-count">
                                    箱子：{{foodItem.boxNumber}}
                                </view>
                            </view>
                        </view>
                    </view>
                    <view class="food-item-count" wx:if="{{orderItem.foods.length>1}}">
                        共{{orderItem.foods.length}}件商品
                    </view>
                    <view style="float: right;">
                        <view class="food-des" style="display: inline-block;margin-right: 10rpx;">
                            总价
                            <block wx:if="{{orderItem.expiredFlag}}">
                                <text style="font-size:25rpx;">¥</text>{{orderItem.orderPrice}} <text style="color:#ccc;" decode>&nbsp;/</text>
                            </block>
                            <block wx:else>
                                <text style="font-size:25rpx;">¥</text><text style="color:#F56C6C;">{{orderItem.orderPrice}}</text> <text style="color:#ccc;" decode>&nbsp;/</text>
                            </block>
                        </view>
                        <view wx:if="{{orderItem.discountPrice}}" class="food-des" style="display: inline-block;margin-right: 10rpx;">
                            优惠券抵扣
                            <block wx:if="{{orderItem.expiredFlag}}">
                                <text style="font-size:25rpx;">-¥</text>{{orderItem.discountPrice}} <text style="color:#ccc;" decode>&nbsp;/</text>
                            </block>
                            <block wx:else>
                                <text style="font-size:25rpx;">-¥</text><text style="color:#F56C6C;">{{orderItem.discountPrice}}</text> <text style="color:#ccc;" decode>&nbsp;/</text>
                            </block>
                        </view>
                        <view class="food-des" style="display: inline-block;">
                            自费
                            <block wx:if="{{orderItem.expiredFlag}}">
                                <text style="font-size:25rpx;">¥</text>{{orderItem.payPrice}}
                            </block>
                            <block wx:else>
                                <text style="font-size:25rpx;">¥</text><text style="color:#F56C6C;">{{orderItem.payPrice}}</text>
                            </block>
                        </view>
                    </view>
                    <view class="" style="clear:both;display: flex;justify-content: space-between;">
                        <view style="height: 30rpx;line-height: 30rpx;">
                            <block wx:if="{{orderItem.expiredFlag}}">
                                <text class="iconfont icon-dingdanbianhao" style="font-size: 25rpx;" decode>&nbsp;{{orderItem.orderCode}}</text>
                            </block>
                            <block wx:else>
                                <text class="iconfont icon-dingdanbianhao" style="font-size: 25rpx;color:#e79b37;" decode>&nbsp;{{orderItem.orderCode}}</text>
                            </block>
                        </view>
                        <view style="height: 30rpx;line-height: 30rpx;font-size: 25rpx;">
                            {{orderItem.payStatusDes}}
                        </view>
                    </view>
                    <view class="button-wrapper" style="clear: both;">
                        <block wx:if="{{!orderItem.expiredFlag}}">
                            <view class="button quxiao" style="" catchtap="handleCancelOrder" data-orderindex="{{orderIndex}}" data-ordercode="{{orderItem.orderCode}}" data-payprice="{{orderItem.payPrice}}" data-paystatus="{{orderItem.payStatus}}" wx:if="{{orderItem.orderStatus  == 'PAYED_WAITINT_CONFIRM' || orderItem.orderStatus  == 'NO_PAY'}}">
                                取消订单
                            </view>
                            <view class="button pingjia" style="" catchtap="handleEvaluateOrder" data-orderindex="{{orderIndex}}" data-ordercode="{{orderItem.orderCode}}" data-foodcode="{{orderItem.foods[0].foodCode}}" data-foods="{{orderItem.foods}}" wx:if="{{orderItem.evaluateFlag}}">
                                评价有赏
                            </view>
                            <view class="button quccan" style="background: #43964e;" catchtap="handleTakeOrder" data-ordercode="{{orderItem.orderCode}}" data-cabinet="{{orderItem.cabinet}}" wx:if="{{orderItem.takeMealFlag}}">
                                点我开柜
                            </view>
                            <view class="button fukuan" style="background: #43964e;" catchtap="handleSecondpayOrder" data-orderindex="{{orderIndex}}" data-ordercode="{{orderItem.orderCode}}" wx:if="{{orderItem.orderStatus  == 'NO_PAY' }}">
                                去付款
                            </view>
                        </block>
                    </view>
                </view>
            </view>
            <view class="hasMore-wrapper" wx:if="{{hasMoreDataFlag}}" bindtap="gotoNextPage" style="font-size:30rpx;color:#666;text-align: center;height: 80rpx;line-height: 80rpx;">
                点击加载更多
            </view>
            <view wx:else class="hasMore-wrapper" style="font-size:30rpx;color:#666;text-align: center;height: 80rpx;line-height: 80rpx;">
                没有更多了..
            </view>
        </view>
    </scroll-view> -->